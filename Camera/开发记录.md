# **目录**   
+ [2019年10月4日](#2019年10月4日)  
+ [2019年10月6日](#2019年10月6日)  
+ [2019年10月8日](#2019年10月8日)  
+ [2019年10月9日](#2019年10月9日)  
+ [2019年10月10日](#2019年10月10日) 
+ [2019年10月18日](#2019年10月18日) 
---
## 2019年10月4日
### **视觉部分需要实现的功能**
* 获取图片，识别出零件上的条码，并获取每个零件中心的**二维坐标**，将**条码-坐标对**输出给机器人系统；
* 机器人无法实现**俯仰运动**，单目相机无法测得深度，故标定结果提供的是二维坐标；
### **视觉部分整体框架**
1. 机器人运动到**事先试验确定**的位置后，拍摄图像；调用接口：`Cam::GetImage(Mat &img)`;
    * 调用`GetImage()`之前需要确保相机已经打开，调用`Cam::OpenDevice();`打开相机；
    * 由于位置是确定的，直接对原图取ROI，舍弃多余图像部分；
2. 根据**实验确定的值，或者根据图像计算值**，对图像进行二值化，得到的图像为黑色部分为感兴趣区域；
3. 将二值图**膨胀k次，然后腐蚀k+1次**，去掉**小孔区域噪音**，并确保感兴趣区域更大，搜索轮廓；
    * **不可**腐蚀到将条码单独完整提出，否则下一步将冲突；
4. 遍历搜索到的轮廓，根据外接矩形提取ROI，**当且仅当**轮廓中识别到**1个条码**时，将该ROI另外保存；
    * 当有2个轮廓识别到同一条码时产生冲突，应该使用区域更大的轮廓；
5. 将另外保存的ROI更精细地识别轮廓，并考虑更优化的直线拟合边界；
6. 计算识别轮廓的中心，并计算归一化坐标，形成**条码-归一化坐标对**，输出给机器人系统；
7. 机器人系统通过**条码**得知工件高度，读取当前自身高度，并通过**机器人-相机坐标系变换关系**得知相机-物体距离，从而实施抓取；

### 待解决的问题
1. 找到合适的**二值化分割阈值**，或者找到合适的方法计算阈值；
2. 如何确定机器人坐标系与相机坐标系的变换关系；
   > + 无法通过**手眼标定**解决，因为机器人只能3轴直线运动，手眼标定函数总是成立；
   > + 采用示教实验形式确定，或采用测量臂测量方式；


## 2019年10月6日
> 相机标定结果：
> + 像素焦距：fx = 3551.024, fy = 3550.081
> + 主点：[u0, v0] = [ 2796.942, 1807.466 ]
> + 径向畸变系数：[-0.106537147733084,0.100320609326180,-0.021073642930310]  


## 2019年10月8日
+ 针对工装特殊形状，对轮廓进行筛选，轮廓包含点数量`contour.size()<12`的轮廓不是适合轮廓；
+ 修复“提取精细轮廓”部分代码**无法识别条码**的bug；原因为对粗提取轮廓进一步提取轮廓时，对bin_img取ROI；

## 2019年10月9日
+ 修复**精细轮廓显示有偏差**的bug；原因为对粗提取范围img_roi提取的轮廓，却对roi绘制轮廓；
+ 修复**无法提取第二个条码所在的精细轮廓**的bug；原因为Mat赋值为**浅拷贝**，将赋值改为调用`Mat::copyTo(Mat dst)`函数；
+ 添加**显示所有提取到的条码的精细轮廓以及中心点**代码；
+ 存在问题：需要根据图像手动二值化分割阈值；应该**控制光照条件**或者**智能计算阈值**；
+ 线性回归进行手眼标定，标定结果**机器人末端->相机坐标系原点**向量为`[220.01036124, -10.900641, 187.0023628]`;

## 2019年10月10日
+ 由于拍摄位置固定，添加对原始图像预先选取ROI过程；
+ 测试标定结果误差，x、y方向误差约为`3mm`，不能用于实际操作；
+ 重新采集实验数据，进行手眼标定；标定结果**机器人末端->相机坐标系原点**向量为`[221.84949437, -7.67242404, 185.06358759]`;

## 2019年10月18日
+ 重新采集实验数据，进行手眼标定，标定结果**机器人末端->相机坐标系原点**向量为`[221.56020953， -8.69628359， 174.5003004]`;
+ 机器人坐标系有变化，抓取高度更改为`-78.9`；
